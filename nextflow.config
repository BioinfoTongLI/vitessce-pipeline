profiles {

  conda {
    executor = 'local'
    singularity.enabled = false
    docker.enabled = false
    conda.enabled = true
    process.conda = "${projectDir}/docker/conda.yaml"
    conda.useMamba = false
  }

  docker {
    executor = 'local'
    singularity.enabled = false
    singularity.autoMounts = false

    docker.enabled = true
    process.container = 'haniffalab/webatlas-pipeline:0.3.2'
  }

  sanger_lsf {
    process.container = 'haniffalab/webatlas-pipeline:0.3.2'
    process.queue = 'imaging'

    docker.enabled = false
    singularity {
        enabled = true
        autoMounts = false
        runOptions = '--bind /lustre --bind /nfs --cleanenv --home /tmp'
    }
    executor {
        name = 'lsf'
        perJobMemLimit = true
        container = '/lustre/scratch127/cellgen/cellgeni/tickets/tic-2248/actions/docker--haniffalab--vitessce-pipeline--0.0.1.sif'
        jobName = { "$task.hash" }
        queue = 'imaging'
    }
  }
}

process {

    withName: image_to_zarr {
        memory = 20.GB
        cpus = 4
    }

    withName: ome_zarr_metadata {
        memory = 2.GB
        cpus = 1
    }

    withName: route_file {
        memory = 10.GB
        cpus = 1
    }

    withName: Build_config {
        memory = 2.GB
        cpus = 1
    }

    withName: Generate_image {
        memory = 20.GB
        cpus = 4
    }
}

timeline {
    enable = true
}

// see https://www.nextflow.io/docs/latest/config.html#scope-aws
aws {
  accessKey = '[YOUR-ACCESS-KEY]'
  secretKey = '[YOUR-SECRET-KEY]'
  client {
        endpoint = 'https://cog.sanger.ac.uk'
        signerOverride = "S3SignerType"
  }
}

cleanup=true
